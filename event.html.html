<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>果凍 / Vcoin 7 天紀錄</title>
  <style>
    :root{
      --bg0:#060913;
      --bg1:#0b1024;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --line:rgba(255,255,255,.10);
      --text:#eef2ff;
      --muted:#a9b6ff;
      --accent:#4f7cff;
      --accent2:#33d1a5;
      --danger:#ff4e6a;
      --warn:#ffcc66;
      --shadow: 0 14px 40px rgba(0,0,0,.45);
      --r:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 15% 10%, rgba(79,124,255,.20), transparent 60%),
        radial-gradient(900px 520px at 85% 25%, rgba(51,209,165,.16), transparent 60%),
        radial-gradient(800px 520px at 55% 95%, rgba(255,204,102,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }
    .wrap{ max-width:1220px; margin:auto; padding:22px 18px 28px; }
    header{ display:flex; align-items:flex-end; justify-content:space-between; gap:14px; margin-bottom:14px; }
    h1{ margin:0; font-size:20px; letter-spacing:.4px; }
    .sub{ font-size:12px; color:var(--muted); line-height:1.6; }
    .pill{ display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid var(--line); background:rgba(0,0,0,.18); font-size:11px; color:var(--muted); }

    .layout{ display:grid; grid-template-columns: 1.15fr .85fr; gap:14px; }
    @media(max-width:980px){ .layout{ grid-template-columns:1fr; } }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hd{ padding:12px 14px; border-bottom:1px solid var(--line); background:rgba(255,255,255,.03); display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .hd .title{ font-size:13px; color:var(--muted); letter-spacing:.35px; display:flex; align-items:center; gap:8px; }
    .bd{ padding:14px; }

    .twoCols{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media(max-width:720px){ .twoCols{ grid-template-columns:1fr; } }

    .panel{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
    }
    .panelHead{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .panelHead .name{ display:flex; align-items:center; gap:10px; }
    .panelHead b{ font-size:14px; }

    label{ display:block; font-size:12px; color:var(--muted); margin:0 0 4px; }
    input{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(7,10,22,.55);
      color:var(--text);
      outline:none;
      font-family:var(--mono);
      font-size:13px;
    }
    input:focus{ border-color:rgba(79,124,255,.55); box-shadow:0 0 0 3px rgba(79,124,255,.16); }

    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px; }
    .row.one{ grid-template-columns:1fr; }

    .btnRow{ display:flex; flex-wrap:wrap; gap:8px; }
    button{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:9px 12px;
      border-radius:12px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      font-size:13px;
    }
    button:hover{ border-color:rgba(79,124,255,.40); background:rgba(79,124,255,.12); }
    button:active{ transform:translateY(1px); }
    button.primary{ background:rgba(79,124,255,.20); border-color:rgba(79,124,255,.55); }
    button.danger{ background:rgba(255,78,106,.14); border-color:rgba(255,78,106,.55); }

    .hint{ font-size:12px; color:var(--muted); line-height:1.6; }

    .progressBox{ margin-top:10px; }
    .progressTop{ display:flex; justify-content:space-between; gap:10px; font-size:12px; color:var(--muted); align-items:baseline; }
    .progressTop .big{ color:var(--text); font-size:14px; font-family:var(--mono); }
    .progress{
      background:rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px;
      overflow:hidden;
      height:14px;
      margin-top:6px;
    }
    .bar{ height:100%; width:0%; }
    .bar.j{ background: linear-gradient(90deg, rgba(255,204,102,.95), rgba(79,124,255,.90)); }
    .bar.v{ background: linear-gradient(90deg, rgba(51,209,165,.95), rgba(79,124,255,.90)); }

    .hist{ margin-top:12px; border-top:1px solid var(--line); padding-top:12px; }
    .histItem{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      border-radius:14px;
      padding:10px;
      margin-bottom:8px;
    }
    .histTop{ display:flex; justify-content:space-between; gap:10px; align-items:baseline; }
    .histTop .t{ font-family:var(--mono); font-size:11px; color:var(--muted); }
    .histTop .n{ font-size:13px; }
    .histBody{ font-family:var(--mono); font-size:12px; white-space:pre-wrap; word-break:break-word; opacity:.95; margin-top:6px; }

    .svgIcon{ width:20px; height:20px; filter: drop-shadow(0 8px 18px rgba(0,0,0,.35)); }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>果凍 / Vcoin 7 天紀錄</h1>
      <div class="sub">每週四重置（依瀏覽器時間判斷）。簽到固定 +100 果凍 / +250 Vcoin；其餘活動可自行輸入或點擊扣除。</div>
    </div>
    <div class="pill" id="weekInfo">週期：—</div>
  </header>

  <div class="layout">
    <!-- 左：輸入與操作 -->
    <section class="card">
      <div class="hd">
        <div class="title">操作面板</div>
        <div class="pill">目標無上限</div>
      </div>
      <div class="bd">
        <div class="row">
          <div>
            <label>果凍目標</label>
            <input id="goalJelly" type="number" min="0" placeholder="輸入目標（可留空）" />
          </div>
          <div>
            <label>Vcoin 目標</label>
            <input id="goalV" type="number" min="0" placeholder="輸入目標（可留空）" />
          </div>
        </div>

        <div class="panel" style="margin-bottom:12px">
          <div class="panelHead">
            <div class="name"><b>每日簽到</b></div>
            <span class="pill" id="checkinStatus">今日未簽到</span>
          </div>
          <div class="btnRow">
            <button class="primary" style="padding:14px 18px;font-size:15px" onclick="dailyCheckin()">每日簽到（+100 果凍 / +250 Vcoin）</button>
          </div>
        </div>

        <div class="twoCols" style="margin-top:10px">
          <!-- 果凍：直排 -->
          <div class="panel">
            <div class="panelHead">
              <div class="name">
                <svg class="svgIcon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M7 10c0-3 2.5-6 5-6s5 3 5 6-2.2 8-5 8-5-5-5-8Z" fill="rgba(255,204,102,.95)"/>
                  <path d="M8.2 9.8c.4-2.3 2.3-4.4 3.8-4.4 1.2 0 2.5 1.2 3.2 2.8" stroke="rgba(255,255,255,.65)" stroke-width="1.2" stroke-linecap="round"/>
                </svg>
                <b>果凍</b>
              </div>
              <span class="pill" id="todayLimits">今日限制：—</span>
            </div>

            <div class="row one">
              <div>
                <label>釣魚活動（果凍）</label>
                <input id="fish" type="number" placeholder="輸入獲得果凍" />
              </div>
            </div>
            <div class="row one">
              <div>
                <label>煙火活動（果凍）</label>
                <input id="fire" type="number" placeholder="輸入獲得果凍" />
              </div>
            </div>

            <div class="row">
              <div>
                <label>Pudgy（果凍）</label>
                <input id="pudgyJ" type="number" placeholder="輸入獲得果凍" />
              </div>
              <div>
                <label>其他獲得（果凍）</label>
                <input id="otherJ" type="number" placeholder="輸入獲得果凍" />
              </div>
            </div>

            <div class="panel" style="margin-top:10px; background:rgba(255,255,255,.02)">
              <div class="panelHead" style="margin-bottom:8px">
                <div class="name"><b style="font-size:13px">扣除項目（點擊）</b></div>
                <span class="pill">自動算入紀錄</span>
              </div>
              <div class="btnRow">
                <button onclick="buyFireworks()">煙火購買（-20 果凍）</button>
                <button onclick="usePenguin()">經驗企鵝（-50 果凍）</button>
              </div>
              <div class="hint" style="margin-top:8px">
                煙火購買：每日最多 15 次。經驗企鵝：平日最多 1 次；六日最多 2 次。
              </div>
            </div>
          </div>

          <!-- Vcoin：直排 -->
          <div class="panel">
            <div class="panelHead">
              <div class="name">
                <svg class="svgIcon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="8.5" fill="rgba(51,209,165,.95)"/>
                  <path d="M9 8.5h3.8c1.8 0 3.2 1 3.2 2.6 0 1.2-.8 2-2 2.3 1.3.3 2.2 1.2 2.2 2.6 0 1.8-1.5 3-3.8 3H9V8.5Zm3.6 5c1.2 0 2-.5 2-1.4 0-.9-.8-1.4-2-1.4H10.6V13.5h2Zm.2 6.2c1.5 0 2.4-.6 2.4-1.7 0-1-.9-1.6-2.4-1.6h-2.2v3.3h2.2Z" fill="rgba(4,8,18,.75)"/>
                </svg>
                <b>Vcoin</b>
              </div>
              <span class="pill">可輸入小遊戲收益</span>
            </div>

            <div class="row one">
              <div>
                <label>Pudgy（Vcoin）</label>
                <input id="pudgyV" type="number" placeholder="輸入獲得 Vcoin" />
              </div>
            </div>

            <div class="row one">
              <div>
                <label>小遊戲（Vcoin）</label>
                <input id="miniV" type="number" placeholder="輸入獲得 Vcoin" />
              </div>
            </div>

            <div class="row one">
              <div>
                <label>其他獲得（Vcoin）</label>
                <input id="otherV" type="number" placeholder="輸入獲得 Vcoin" />
              </div>
            </div>

            <div class="hint">提示：簽到的 Vcoin 已包含在「每日簽到」按鈕中。</div>
          </div>
                <div class="panel" style="margin-top:12px">
          <div class="panelHead">
            <div class="name"><b>輸入完成確認</b></div>
            <span class="pill">確認後才會寫入紀錄</span>
          </div>
          <div class="btnRow">
            <button class="primary" style="padding:14px 18px;font-size:15px;width:100%" onclick="addCustom()">加入今日紀錄</button>
          </div>
        </div>
      </div>
    </section>

    <!-- 右：統計與紀錄 -->
    <aside class="card">
      <div class="hd">
        <div class="title">本週累積</div>
        <div class="btnRow">
          <button class="danger" onclick="resetWeek()">手動重置</button>
        </div>
      </div>
      <div class="bd">
        <div class="progressBox">
          <div class="progressTop">
            <span>果凍</span>
            <span class="big" id="sumJ">0</span>
          </div>
          <div class="progress"><div id="barJ" class="bar j"></div></div>
        </div>

        <div class="progressBox" style="margin-top:12px">
          <div class="progressTop">
            <span>Vcoin</span>
            <span class="big" id="sumV">0</span>
          </div>
          <div class="progress"><div id="barV" class="bar v"></div></div>
        </div>

        <div class="panel" style="margin-bottom:12px">
          <div class="panelHead">
            <div class="name"><b>今日總結</b></div>
            <div class="btnRow">
              <button class="danger" onclick="resetToday()">今日重置</button>
            </div>
          </div>
          <div class="histBody" id="todaySummary">—</div>
        </div>

        <div class="hist">
          <div class="hd" style="padding:0; border:none; background:transparent; margin-bottom:8px">
            <div class="title">紀錄</div>
            <div class="pill" id="histCount">0 筆</div>
          </div>
          <div id="history"></div>
          <div class="hint" id="emptyHint" style="display:none">尚無紀錄。</div>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
  const KEY = 'jelly_vcoin_week_v2';

  function pad2(n){ return String(n).padStart(2,'0'); }

  // 週期：以「星期四」為每週起點
  function getWeekStartISO(){
    const d = new Date();
    const day = d.getDay(); // 0 Sun ... 4 Thu
    const diff = (day >= 4) ? day - 4 : day + 3; // 回推到最近的週四
    const start = new Date(d);
    start.setHours(0,0,0,0);
    start.setDate(start.getDate() - diff);
    return start.toISOString().slice(0,10);
  }

  function todayISO(){
    const d = new Date();
    return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  }

  function load(){
    const raw = localStorage.getItem(KEY);
    const week = getWeekStartISO();
    if(!raw) return {week, logs:[], limits:{}};
    try{
      const data = JSON.parse(raw);
      if(!data || typeof data !== 'object') return {week, logs:[], limits:{}};
      if(data.week !== week) return {week, logs:[], limits:{}};
      data.logs = Array.isArray(data.logs) ? data.logs : [];
      data.limits = (data.limits && typeof data.limits === 'object') ? data.limits : {};
      return data;
    }catch{ return {week, logs:[], limits:{}}; }
  }

  function save(data){ localStorage.setItem(KEY, JSON.stringify(data)); }

  function weekLabel(weekStartISO){
    const d0 = new Date(weekStartISO + 'T00:00:00');
    const d1 = new Date(d0);
    d1.setDate(d1.getDate()+6);
    return `${d0.getFullYear()}/${pad2(d0.getMonth()+1)}/${pad2(d0.getDate())} ~ ${d1.getFullYear()}/${pad2(d1.getMonth()+1)}/${pad2(d1.getDate())}`;
  }

  function logEntry(note, jellyDelta, vDelta){
    const data = load();
    data.logs.push({
      t: new Date().toLocaleString(),
      date: todayISO(),
      jelly: Number(jellyDelta||0),
      v: Number(vDelta||0),
      note: String(note||'')
    });
    save(data);
    render();
  }

  // ====== 你的固定行為 ======
  function hasCheckedInToday(data){
    return data.logs.some(l => l.date === todayISO() && l.note === '每日簽到');
  }

  function dailyCheckin(){
    const data = load();
    if(hasCheckedInToday(data)){
      alert('今日已簽到，不能重複簽到。');
      return;
    }
    data.logs.push({
      t: new Date().toLocaleString(),
      date: todayISO(),
      jelly: 100,
      v: 250,
      note: '每日簽到'
    });
    save(data);
    render();
  }

  function addCustom(){
    const g = id => Number(document.getElementById(id).value || 0);
    const jelly = g('fish') + g('fire') + g('pudgyJ') + g('otherJ');
    const v = g('pudgyV') + g('miniV') + g('otherV');
    if(jelly === 0 && v === 0) return;
    logEntry('活動/其他（輸入）', jelly, v);
    ['fish','fire','pudgyJ','otherJ','pudgyV','miniV','otherV'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
  }

  // ====== 扣除項目：每日限制 ======
  function getLimitState(data){
    const d = todayISO();
    if(!data.limits[d]) data.limits[d] = { fireworksBuy:0, penguinUse:0 };
    return data.limits[d];
  }

  function buyFireworks(){
    const data = load();
    const st = getLimitState(data);
    if(st.fireworksBuy >= 15){
      alert('今日煙火購買已達上限（15 次）。');
      return;
    }
    st.fireworksBuy += 1;
    save(data);
    logEntry(`煙火購買（第 ${st.fireworksBuy}/15 次）`, -20, 0);
  }

  function isWeekend(){
    const d = new Date();
    const day = d.getDay();
    return day === 0 || day === 6;
  }

  function usePenguin(){
    const data = load();
    const st = getLimitState(data);
    const cap = isWeekend() ? 2 : 1;
    if(st.penguinUse >= cap){
      alert(`今日經驗企鵝已達上限（${cap} 次）。`);
      return;
    }
    st.penguinUse += 1;
    save(data);
    logEntry(`經驗企鵝（第 ${st.penguinUse}/${cap} 次）`, -50, 0);
  }

  function resetToday(){
    const data = load();
    const today = todayISO();
    data.logs = data.logs.filter(l => l.date !== today);
    delete data.limits[today];
    save(data);
    render();
  }

  function resetWeek(){
    if(!confirm('確定要手動重置本週紀錄？')) return;
    save({week: getWeekStartISO(), logs:[], limits:{}});
    render();
  }

  // ====== UI 渲染 ======
  function goalVal(id){
    const v = document.getElementById(id).value;
    if(v === '' || v === null || v === undefined) return null;
    const n = Number(v);
    return Number.isFinite(n) && n > 0 ? n : null;
  }

  function clampPct(p){
    if(!Number.isFinite(p)) return 0;
    return Math.max(0, Math.min(100, p));
  }

  function render(){
    const data = load();
    document.getElementById('weekInfo').textContent = `週期：${weekLabel(data.week)}`;

    // 簽到狀態
    const checked = data.logs.some(l => l.date === todayISO() && l.note === '每日簽到');
    const statusEl = document.getElementById('checkinStatus');
    const btn = document.querySelector('button.primary');
    if(checked){ statusEl.textContent = '今日已簽到'; btn.disabled = true; btn.style.opacity = .6; }
    else{ statusEl.textContent = '今日未簽到'; btn.disabled = false; btn.style.opacity = 1; }

    // 今日限制顯示
    const st = getLimitState(data);
    const cap = isWeekend() ? 2 : 1;
    document.getElementById('todayLimits').textContent = `今日：煙火 ${st.fireworksBuy}/15｜企鵝 ${st.penguinUse}/${cap}`;

    // 加總
    let sj=0, sv=0;
    let tj=0, tv=0;
    for(const l of data.logs){
      sj += Number(l.jelly||0); sv += Number(l.v||0);
      if(l.date === todayISO()){ tj += Number(l.jelly||0); tv += Number(l.v||0); }
    }
    document.getElementById('sumJ').textContent = sj;
    document.getElementById('sumV').textContent = sv;
    document.getElementById('todaySummary').textContent = `果凍 ${fmtSigned(tj)}
Vcoin ${fmtSigned(tv)}`;

    // 進度條
    const gj = goalVal('goalJelly');
    const gv = goalVal('goalV');
    const pj = gj ? clampPct((sj/gj)*100) : 0;
    const pv = gv ? clampPct((sv/gv)*100) : 0;
    document.getElementById('barJ').style.width = pj + '%';
    document.getElementById('barV').style.width = pv + '%';

    // 歷史
    const list = document.getElementById('history');
    const empty = document.getElementById('emptyHint');
    list.innerHTML = '';
    const items = data.logs.slice().reverse();
    document.getElementById('histCount').textContent = `${items.length} 筆`;

    if(items.length === 0){ empty.style.display = 'block'; return; }
    empty.style.display = 'none';

    for(const it of items){
      const div = document.createElement('div');
      div.className = 'histItem';
      div.innerHTML = `
        <div class="histTop">
          <div class="n">${escapeHtml(it.note || '')}</div>
          <div class="t">${escapeHtml(it.t || '')}</div>
        </div>
        <div class="histBody">果凍 ${fmtSigned(it.jelly)}
Vcoin ${fmtSigned(it.v)}</div>
      `;
      list.appendChild(div);
    }
  }

  function fmtSigned(n){
    const x = Number(n||0);
    if(x > 0) return `+${x}`;
    return String(x);
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#039;');
  }

  // 目標輸入變更即更新進度
  document.getElementById('goalJelly').addEventListener('input', render);
  document.getElementById('goalV').addEventListener('input', render);

  render();
</script>
</body>
</html>
